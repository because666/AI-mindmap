# DeepMindMap V2 - 开发任务清单

## 阶段一：基础架构搭建（第1-2周）

### 1.1 项目初始化
- [ ] 创建前端项目 (React + TypeScript + Vite)
- [ ] 创建后端项目 (Node.js + Express + TypeScript)
- [ ] 配置 ESLint + Prettier
- [ ] 配置 Git 仓库
- [ ] 配置 Docker 环境

### 1.2 数据库设计
- [ ] 安装并配置 MongoDB
- [ ] 创建 Node 数据模型
- [ ] 创建 Conversation 数据模型
- [ ] 创建 Relation 数据模型
- [ ] 创建 Workspace 数据模型
- [ ] 创建 User 数据模型
- [ ] 创建 History 数据模型
- [ ] 创建 Snapshot 数据模型

### 1.3 基础API框架
- [ ] 搭建 Express 服务器
- [ ] 配置路由系统
- [ ] 实现错误处理中间件
- [ ] 实现请求验证中间件
- [ ] 配置 CORS

### 1.4 前端基础结构
- [ ] 配置 TailwindCSS
- [ ] 配置 React Router
- [ ] 配置 Axios 实例
- [ ] 配置 Zustand 状态管理
- [ ] 创建基础布局组件

### 1.5 认证系统
- [ ] 实现用户注册 API
- [ ] 实现用户登录 API
- [ ] 实现 JWT Token 生成与验证
- [ ] 实现前端登录页面
- [ ] 实现前端注册页面
- [ ] 实现路由守卫

---

## 阶段二：核心功能开发（第3-6周）

### 2.1 节点管理功能

#### 后端
- [ ] 实现创建节点 API
- [ ] 实现获取节点详情 API
- [ ] 实现更新节点 API
- [ ] 实现删除节点 API
- [ ] 实现获取工作区节点树 API
- [ ] 实现多父节点关联逻辑
- [ ] 实现节点位置更新 API

#### 前端
- [ ] 创建节点状态管理 (nodeStore)
- [ ] 实现节点创建对话框
- [ ] 实现节点编辑面板
- [ ] 实现节点删除确认
- [ ] 实现节点树侧边栏
- [ ] 实现多父节点选择器

### 2.2 画布可视化功能

#### 基础集成
- [ ] 集成 React Flow
- [ ] 创建画布容器组件
- [ ] 实现画布缩放控制
- [ ] 实现画布平移控制
- [ ] 实现小地图 (MiniMap)

#### 自定义节点
- [ ] 创建根节点组件 (RootNode)
- [ ] 创建分支节点组件 (BranchNode)
- [ ] 创建叶子节点组件 (LeafNode)
- [ ] 创建复合节点组件 (CompositeNode)
- [ ] 实现节点预览显示
- [ ] 实现节点选中状态
- [ ] 实现节点悬停效果

#### 自定义边
- [ ] 创建默认边组件
- [ ] 创建关系边组件
- [ ] 实现边标签显示
- [ ] 实现边动画效果

#### 交互功能
- [ ] 实现节点拖拽
- [ ] 实现节点连线
- [ ] 实现画布右键菜单
- [ ] 实现节点双击打开对话
- [ ] 实现画布快捷键

### 2.3 对话功能

#### 后端
- [ ] 实现创建对话 API
- [ ] 实现发送消息 API (流式响应)
- [ ] 实现获取对话历史 API
- [ ] 实现删除消息 API
- [ ] 集成 OpenAI API
- [ ] 集成 Claude API
- [ ] 实现多模型切换逻辑
- [ ] 实现 SSE 流式响应

#### 前端
- [ ] 创建对话状态管理 (chatStore)
- [ ] 实现对话面板组件
- [ ] 实现消息列表组件
- [ ] 实现消息气泡组件
- [ ] 实现输入区域组件
- [ ] 实现流式消息显示
- [ ] 实现Markdown渲染
- [ ] 实现代码高亮
- [ ] 实现消息复制功能

---

## 阶段三：高级功能开发（第7-10周）

### 3.1 关系管理功能

#### 后端
- [ ] 实现创建关系 API
- [ ] 实现更新关系 API
- [ ] 实现删除关系 API
- [ ] 实现获取节点关系 API
- [ ] 实现关系类型枚举

#### 前端
- [ ] 创建关系状态管理
- [ ] 实现关系编辑对话框
- [ ] 实现关系类型选择器
- [ ] 实现关系可视化显示
- [ ] 实现关系标签编辑

### 3.2 智能上下文系统

#### 后端
- [ ] 实现上下文构建服务
- [ ] 实现父节点上下文递归获取
- [ ] 实现关系节点上下文获取
- [ ] 实现上下文权重计算
- [ ] 实现上下文缓存机制
- [ ] 实现上下文Token限制处理
- [ ] 实现结论提炼功能

#### 前端
- [ ] 实现上下文配置面板
- [ ] 实现上下文预览功能
- [ ] 实现上下文节点选择器
- [ ] 实现结论提炼对话框

### 3.3 复合节点功能

#### 后端
- [ ] 实现节点聚合 API
- [ ] 实现复合节点展开 API
- [ ] 实现复合节点内容获取 API
- [ ] 实现复合节点编辑 API

#### 前端
- [ ] 实现节点多选功能
- [ ] 实现聚合操作面板
- [ ] 实现复合节点展开/折叠
- [ ] 实现复合节点内部视图

---

## 阶段四：辅助功能开发（第11-12周）

### 4.1 搜索功能

#### 后端
- [ ] 实现全文搜索 API
- [ ] 实现节点内容搜索
- [ ] 实现对话内容搜索
- [ ] 实现搜索结果排序
- [ ] 实现搜索高亮

#### 前端
- [ ] 实现搜索栏组件
- [ ] 实现搜索结果列表
- [ ] 实现搜索结果高亮
- [ ] 实现搜索结果定位

### 4.2 历史版本功能

#### 后端
- [ ] 实现操作记录服务
- [ ] 实现创建快照 API
- [ ] 实现获取快照列表 API
- [ ] 实现回滚快照 API
- [ ] 实现撤销/重做 API

#### 前端
- [ ] 实现历史面板组件
- [ ] 实现快照管理面板
- [ ] 实现撤销/重做按钮
- [ ] 实现快照创建对话框
- [ ] 实现版本对比视图

### 4.3 导入导出功能

#### 后端
- [ ] 实现导出为 JSON API
- [ ] 实现导出为 Markdown API
- [ ] 实现导入 JSON API
- [ ] 实现导入验证

#### 前端
- [ ] 实现导出菜单
- [ ] 实现导入对话框
- [ ] 实现导出进度显示

---

## 阶段五：优化与测试（第13-14周）

### 5.1 性能优化
- [ ] 实现节点虚拟化渲染
- [ ] 实现大画布分块加载
- [ ] 实现对话消息虚拟滚动
- [ ] 优化 React 组件渲染
- [ ] 实现图片懒加载
- [ ] 优化 MongoDB 查询索引

### 5.2 单元测试
- [ ] 配置 Jest 测试环境
- [ ] 编写节点服务测试
- [ ] 编写对话服务测试
- [ ] 编写关系服务测试
- [ ] 编写上下文服务测试
- [ ] 编写前端组件测试

### 5.3 集成测试
- [ ] 配置测试数据库
- [ ] 编写 API 集成测试
- [ ] 编写端到端测试
- [ ] 编写 WebSocket 测试

### 5.4 用户测试
- [ ] 准备测试用例
- [ ] 邀请测试用户
- [ ] 收集用户反馈
- [ ] 修复发现的问题

---

## 阶段六：部署与上线（第15周）

### 6.1 生产环境配置
- [ ] 配置生产环境变量
- [ ] 配置 MongoDB 生产实例
- [ ] 配置 Redis 缓存
- [ ] 配置 CDN
- [ ] 配置 HTTPS 证书

### 6.2 部署脚本
- [ ] 编写 Dockerfile
- [ ] 编写 docker-compose.yml
- [ ] 编写部署脚本
- [ ] 配置 CI/CD 流水线

### 6.3 监控与日志
- [ ] 配置日志系统
- [ ] 配置错误监控
- [ ] 配置性能监控
- [ ] 配置告警系统

### 6.4 文档完善
- [ ] 编写用户手册
- [ ] 编写 API 文档
- [ ] 编写部署文档
- [ ] 编写开发文档

---

## 优先级说明

| 优先级 | 说明 |
|--------|------|
| P0 | 核心功能，必须完成 |
| P1 | 重要功能，应该完成 |
| P2 | 增强功能，可以延后 |
| P3 | 优化功能，按需完成 |

## 依赖关系

```
阶段一 (基础架构)
    │
    ├──→ 阶段二 (核心功能) ──→ 阶段三 (高级功能)
    │                              │
    │                              └──→ 阶段四 (辅助功能)
    │                                        │
    └────────────────────────────────────────┴──→ 阶段五 (优化测试)
                                                      │
                                                      └──→ 阶段六 (部署上线)
```
